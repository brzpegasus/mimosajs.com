<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Optimization - Mimosa</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/bootstrap.min.css" >
  <link rel="stylesheet" href="css/bootstrap-responsive.min.css" >
  <link rel="stylesheet" href="css/app.css">

  <link rel="shortcut icon" href="img/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-57-precomposed.png">
</head>
<body data-spy="scroll" data-target=".subnav" data-offset="50">

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <div class="nav-collapse collapse">
          <ul class="nav">
            <li class="">
              <a href="./index.html">Mimosa</a>
            </li>
            <li class="">
              <a href="./started.html">Get Started</a>
            </li>
            <li class="">
              <a href="./commands.html">Commands</a>
            </li>
            <li class="">
              <a href="./compilers.html">Compilers</a>
            </li>
            <li  class="">
              <a href="./modules.html">Extend: Modules</a>
            </li>
            <li class="">
              <a href="./server.html">Serve</a>
            </li>
            <li class="">
              <a href="./utilities.html">Utilities</a>
            </li>
            <li class="active">
              <a href="./optimization.html">Optimization</a>
            </li>
            <li class="">
              <a href="./configuration.html">Configuration</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

<div class="container main">

  <header class="jumbotron subhead" id="overview">
    <h1>Optimization</h1>
    <p class="lead">Mimosa utilizes RequireJS and Uglify to make your code production ready when you need it to be</p>
    <div class="subnav">
      <ul class="nav nav-pills">
        <li><a href="#opt" title="Optimization">Optimization</a></li>
        <li><a href="#require" title="using the r.js optimizer">RequireJS Optimization</a></li>
        <li><a href="#min" title="Keep your assets nice and small">Minify</a></li>
        <li><a href="#minopt" title="both is good">Minify + Optimize</a></li>
        <li><a href="#css" title="Minify your CSS too">CSS</a></li>
      </ul>
    </div>
  </header>

  <section class="command-list">
    <section id="opt">
      <div class="page-header">
        <h1>
          Optimization Explained
          <small><span class="options" title="O no!">zip it up, flip it, compress it down</span></small>
        </h1>
      </div>
      <p>In the normal course of development (in a pre <a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/">source maps</a> world) assets are best loaded individually rather than in one merged file. And assets definitely should not be minified or mangled. This all makes for easier debugging.</p>

      <p>But when an application is taken to production, all the performance improvements that come with merging, optimizing, and minifying assets should be included. For both the <code class="option">build</code> and <code class="option">watch</code> commands, Mimosa provides <code class="option">--optimize</code> and <code class="option">--minify</code> flags that combine to provide both the ability to fully optimize an application, and to have a more control over what gets optimized.</p>

      <p>Via the <code class="option">mimosa-require</code> module that comes with Mimosa by default, Mimosa uses the <a href="https://github.com/jrburke/r.js/">r.js optimizer</a> which is perfect for optimizing RequireJS applications. Underneath the hood, that optimizer is using <a href="https://github.com/mishoo/UglifyJS">Uglify</a> to shrink a codebase down as tiny as possible. Mimosa bundles Uglify2, and can use it to individually shrink assets. And Mimosa's Uglify and the r.js optimizer can be combined to provide more fine-grained control over a minification strategy.</p>

    </section>
    <section id="require">
      <div class="page-header">
        <h1>
          RequireJS Optimization
          <small><span class="options">with the r.js optimizer automatically included in your workflow</span></small>
        </h1>
      </div>

      <p>For both the <code class="option">build</code> and <code class="option">watch</code> commands, Mimosa provides an <code class="option">--optimize</code> flag that will turn on optimization.  Mimosa wraps the <a href="https://github.com/jrburke/r.js/">r.js optimizer</a> and runs it with a default configuration gleaned from the setup of the application.</p>

      <p>When a codebase is optimized and pulled together into one file, the RequireJS library is no longer necessary. Mimosa will wrap r.js optimized code in <a href="https://github.com/jrburke/almond">Almond</a>, a replacement AMD loader for RequireJS that provides the minimal functionality necessary for optimized files.</p>

      <p>Mimosa's RequireJS optimization support comes courtesy of the <code class="option">mimosa-require</code> module, a default Mimosa module that comes with Mimosa when it is installed.</p>

      <h2>Optimizer Default Settings</h2>

      <p>Mimosa will infer the following default settings for the r.js optimizer.</p>

      <ul>
        <li><code class="option">baseUrl</code>: set by combining the mimosa-config <code class="option">watch.compiledDir</code> with the <code class="option">compilers.javascript.directory</code></li>
        <li><code class="option">out</code>: optimized files are output into the <code class="option">watch.compiled</code> + <code class="option">compilers.javascript.directory</code> in a file that is the main module name + <code class="option">-built.js</code></li>
        <li><code class="option">mainConfigFile</code>: set to the file path of the main module</li>
        <li><code class="option">findNestedDependencies</code>: <code class="option">true</code></li>
        <li><code class="option">wrap</code>: <code class="option">true</code></li>
        <li><code class="option">include</code>: set to the name of the module being compiled</li>
        <li><code class="option">insertRequire</code>: set to the name of the module being compiled</li>
        <li><code class="option">name</code>: set to <code class="option">almond</code></li>
        <li><code class="option">logLevel</code>: set to <code class="option">3</code> which is the r.js error logging level</li>
      </ul>

      <p>These settings will package up each individual module into its own optimized file wrapped with Almond.</p>

      <h2>Overriding and Including Additional Optimizer Settings</h2>

      <p>Any of the other RequireJS <a href="http://requirejs.org/docs/optimization.html#options">optimizer configuration options</a> can be included in the mimosa-config. Just uncomment the <code class="option">require.optimize.overrides</code> setting and include those settings there. Settings can be both overridden and removed. To override a Mimosa setting, put the override in <code class="option">overrides</code>. To remove a default setting, set it to <code class="option">null</code>.</p>

      <p><code class="option">require.optimize.overrides</code> can also be configured as a function. That function is passed the full inferred r.js config for the module being optimized. This provides the opportunity to amplify the inferred config rather than just replace it.</p>

      <p>Mimosa can also be configured to not infer anything and to go entirely with a custom config. Set <code class="option">require.optimize.inferConfig</code> to false and Mimosa will run r.js with only the settings provided in <code class="option">require.optimize.overrides</code>.</p>

      <p>Also use <code class="option">require.optimize.inferConfig:false</code> if configuration settings are in script tags in an HTML file, or in any other file that does not compile to JavaScript. For now, Mimosa is only able to make inferences for configs in JavaScript files. If a config (and <code class="option">require</code>/<code class="option">requirejs</code> method calls) are in script tags on an HTML page, Mimosa will not find any modules to compile for optimization and therefore will not run optimization, so a custom configuration will need to be provided in <code class="option">overrides</code> with <code class="option">inferConfig</code> set to <code class="option">false</code>.</p>

      <h2>Programmatically Take Control of the Optimizer with Modules</h2>

      <p>Mimosa can't know all the intricacies of a project.  It can make a lot of educated guesses and put together a really good base r.js config, but there are times when complicated alterations must be made to the r.js config. <code class="option">overrides</code> allows static changes to the r.js configuration, but that isn't always ideal. <code class="option">require.optimize.inferConfig:false</code> loses all of the smarts Mimosa puts into building a r.js config. Ideally a project can take advantage of the work Mimosa puts into building the r.js config, and dynamically alter it as well.</p>

      <p>Mimosa's building of the inferred r.js config, and the execution of the r.js optimization are pulled apart in two separate steps in Mimosa's workflows. Config building executes during the <code class="option">beforeOptimize</code> step, and execution during the <code class="option">optimize</code> step. This means a custom module can programmatically and dynamically alter the Mimosa-prepared r.js configs before r.js execution occurs.</p>

      <p>For instance, maybe there are files to include in the r.js execution that are not pulled in as dependencies by r.js, maybe all .html files via the <a href="https://github.com/requirejs/text">requirejs text plugin</a>, and rather than listing them one by one in the overrides, they could be dynamically added so a list need not be maintained. A module could do this, executing during the <code class="option">beforeOptimize</code> step, but after the configs have been built.  In that module the codebase could be scanned for .html files and push them onto the r.js config <code class="option">include</code> array.</p>

      <p>Doing this provides both Mimosa's smarts, and the intelligence Mimosa can't provide by way of a custom module.  To get started building such a module, check out the long-named example module <a href="https://github.com/dbashford/mimosa-requirebuild-textplugin-include">mimosa-requirebuild-textplugin-include</a> which performs just the task mentioned above.</p>

    </section>
    <section id="min">
      <div class="page-header">
        <h1>
          Minify
          <small><span class="options">shrink down assets but keep them apart</span></small>
        </h1>
      </div>

      <p>For both the <code class="option">build</code> and <code class="option">watch</code> commands, Mimosa provides an <code class="option">--minify</code> flag that will run <a href="https://github.com/mishoo/UglifyJS2">Uglify2</a> over JavaScript assets. The mimosa-config provides the ability to exclude certain files from this minification using the <code class="option">minify.exclude</code> setting. By default any file already possessing <code class="option">.min.</code> in the path name will be excluded as it is assumed to already be minified.</p>

      <p>Mimosa's Minification support comes courtesy of the <code class="option">mimosa-minify</code> module, a default Mimosa module that comes with Mimosa when it is installed.</p>

    </section>
    <section id="minopt">
      <div class="page-header">
        <h1>
          Minify + Optimize
          <small><span class="options">customize your minification strategy</span></small>
        </h1>
      </div>

      <p>For either the <code class="option">build</code> or <code class="option">watch</code> commands, using the <code class="option">--minify</code> and <code class="option">--optimize</code> flags together provides increased control over the optimization workflow.</p>

      <p>The r.js optimizer by itself is often good enough to handle minifying, compressing and pulling modules into single files; however, the occasional file does not take kindly to being run through Uglify and will be broken when compressed. The r.js optimizer is all or none. It does not allow choose to omit a file from compression if it is not compressing correctly.</p>

      <p>When both minifying and optimizing, r.js minification is turned off. Specifically the <code class="option">optimize</code> setting of r.js is set to <code class="option">none</code>. The optimizer is still used to pull all of an application's files together into the same file and wrap it in Almond. But Mimosa will Uglify files first, before calling the optimizer, and Mimosa provides the opportunity to not Uglify whatever files are not making it through Uglifying in working order.</p>

      <p>If a project has many pages, and therefore many optimized files that need to be written, using both flags at the same time will also speed up the build.  If Mimosa writes minified files, then the files are minified once and the minified versions are used to build the many optimized files.If Mimosa writes un-minified files, then those files have to be minified by the r.js optimizer. The optimizer is going to minify each file every time it is used.  So if the unminified jQuery source is in a project's codebase, and it is used on 10 pages and therefore is bundled into 10 optimized files, then r.js will minify it 10 times, which can slow the build.  So, if a build is running slow, try using both flags at once to speed it up.</p>

      <p>The <a href="https://github.com/dbashford/AngularFunMimosa">AngularFunMimosa</a> demo project is a perfect example of a project that benefits from this functionality. <a href="https://github.com/dbashford/AngularFunMimosa/commit/1816016a3444ab960dd79c2f65b63c6bf9fdc488#L1L9">This commit</a> from that project shows the effect of the minify+optimize feature being added to Mimosa. Previously optimization was turned off via Mimosa's r.js overrides, because when r.js Uglified the code, it also broke the application. When this Mimosa feature was added, the r.js override was removed, and the file that was not surviving Uglifying, <code class='option'>main.js</code>, was simply omitted from minification.  What comes out the other side is a fully r.js optimized and zipped up file that is fully compressed with the exception of the file that cannot be minified.</p>

    </section>
    <section id="css">
      <div class="page-header">
        <h1>
          CSS
          <small><span class="options">it gets minified too</span></small>
        </h1>
      </div>
      <p>When the <code class="option">--optimize</code> flag is used, Mimosa will minify CSS files too. And that about covers that.</p>
    </section>
  </section>

</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.7.2.min.js"><\/script>')</script>
<script src="js/vendor/bootstrap-collapse.js"></script>
<script src="js/vendor/bootstrap-scrollspy.js"></script>

<!-- scripts concatenated and minified via build script -->
<script src="js/plugins.js"></script>
<script src="js/main.js"></script>
<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
<!-- end scripts -->

<script>
    var _gaq=[['_setAccount','UA-33737130-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>