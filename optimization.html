<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Optimization - Mimosa</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="css/main.css"> -->
  <link rel="stylesheet" href="css/bootstrap.min.css" >
  <link rel="stylesheet" href="css/bootstrap-responsive.min.css" >
  <link rel="stylesheet" href="css/app.css">

  <link rel="shortcut icon" href="img/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-57-precomposed.png">
</head>
<body data-spy="scroll" data-target=".subnav" data-offset="50">

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <div class="nav-collapse collapse">
          <ul class="nav">
            <li class="">
              <a href="./index.html">Mimosa</a>
            </li>
            <li class="">
              <a href="./started.html">Get Started</a>
            </li>
            <li class="">
              <a href="./commands.html">Commands</a>
            </li>
            <li class="">
              <a href="./compilers.html">Compilers</a>
            </li>
            <li class="">
              <a href="./server.html">Serve</a>
            </li>
            <li class="">
              <a href="./utilities.html">Utilities</a>
            </li>
            <li class="active">
              <a href="./optimization.html">Optimization</a>
            </li>
            <li class="">
              <a href="./configuration.html">Configuration</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

<div class="container main">

  <header class="jumbotron subhead" id="overview">
    <h1>Optimization</h1>
    <p class="lead">Mimosa utilizes RequireJS and Uglify to make your code production ready when you need it to be</p>
    <div class="subnav">
      <ul class="nav nav-pills">
        <li><a href="#opt" title="Optimization">Optimization</a></li>
        <li><a href="#require" title="using the r.js optimizer">RequireJS Optimization</a></li>
        <li><a href="#min" title="Keep your assets nice and small">Minify</a></li>
        <li><a href="#minopt" title="both is good">Minify + Optimize</a></li>
        <li><a href="#css" title="Minify your CSS too">CSS</a></li>
      </ul>
    </div>
  </header>

  <section class="command-list">
    <section id="opt">
      <div class="page-header">
        <h1>
          Optimization Explained
          <small><span class="options" title="O no!">zip it up, flip it, compress it down</span></small>
        </h1>
      </div>
      <p>In the normal course of development (in a pre <a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/">source maps</a> world) you want to have your assets loaded individually rather than in one merged file.  And you certainly don't want your assets minified or mangled. This all makes for easier debugging.</p>

      <p>But when you take your application to production, you want to include all the performance improvements that come with merging, optimizing, and minifying your assets. For both the <code class="option">build</code> and <code class="option">watch</code> commands, Mimosa provides <code class="option">--optimize</code> and <code class="option">--minify</code> flags that combine to provide you both the ability to fully optimize your application, and to have a bit of control over what gets optimized.</p>

      <p>Mimosa uses the <a href="https://github.com/jrburke/r.js/">r.js optimizer</a> which is perfect for optimizing RequireJS applications. Underneath the hood, that optimizer is using <a href="https://github.com/mishoo/UglifyJS">Uglify</a> to shrink your codebase down as tiny as possible. Mimosa bundles Uglify too, and can use it to individually shrink your assets.  And Mimosa's Uglify and the r.js optimizer can be combined to provide more fine-grained control of your minification strategy.</p>

    </section>
    <section id="require">
      <div class="page-header">
        <h1>
          RequireJS Optimization
          <small><span class="options">with the r.js optimizer automatically included in your workflow</span></small>
        </h1>
      </div>

      <p>For both the <code class="option">build</code> and <code class="option">watch</code> commands, Mimosa provides an <code class="option">--optimize</code> flag that will turn on optimization.  Mimosa wraps the <a href="https://github.com/jrburke/r.js/">r.js optimizer</a> and runs it with a default configuration gleaned from the setup of your application.</p>

      <p>When your codebase is optimized and pulled together into one file, the RequireJS library is no longer necessary.  Mimosa will wrap your optimized code in <a href="https://github.com/jrburke/almond">Almond</a>, a replacement AMD loader for RequireJS that provides the minimal functionality necessary for your optimized file.</p>

      <h2>Optimizer Default Settings</h2>

      <p>Mimosa will infer the following default settings for the r.js optimizer.</p>

      <ul>
        <li><code class="option">baseUrl</code>: set by combining the mimosa-config <code class="option">watch.compiledDir</code> with the <code class="option">compilers.javascript.directory</code></li>
        <li><code class="option">out</code>: optimized files are output into the <code class="option">watch.compiled</code> + <code class="option">compilers.javascript.directory</code> in a file that is your main module name + <code class="option">-built.js</code></li>
        <li><code class="option">mainConfigFile</code>: set to the file path of the main module</li>
        <li><code class="option">findNestedDependencies</code>: <code class="option">true</code></li>
        <li><code class="option">wrap</code>: <code class="option">true</code></li>
        <li><code class="option">include</code>: set to the name of the module being compiled</li>
        <li><code class="option">insertRequire</code>: set to the name of the module being compiled</li>
        <li><code class="option">name</code>: set to <code class="option">almond</code></li>
      </ul>

      <p>These settings will package up each individual module you have into its own optimized file wrapped with Almond.</p>

      <h2>Overriding and Including Additional Optimizer Settings</h2>

      <p>You can include any of the other RequireJS <a href="http://requirejs.org/docs/optimization.html#options">optimizer configuration options</a> in the mimosa-config. Simply uncomment the <code class="option">require.optimize.overrides</code> setting and toss your settings in there. You can both override and remove settings. If you want to override a Mimosa setting, just put it in the <code class="option">overrides</code>. If you want a Mimosa default setting removed, set it to <code class="option">null</code>. For instance setting <code class="option">mainConfigFile: null</code> will blank out that setting and it will not be passed to the optimizer.</p>

      <p>You can also choose to not have Mimosa infer anything and to go entirely with your own configuration. Set <code class="option">require.optimize.inferConfig</code> to false and Mimosa will run r.js with only the settings you give it.</p>

      <p>Also use <code class="option">require.optimize.inferConfig:false</code> if you choose to have your configuration settings in script tags in an HTML file, or in any other file that does not compile to JavaScript. For now, Mimosa is only able to make inferences for configs in JavaScript files. If your configuration (and <code class="option">require</code>/<code class="option">requirejs</code> method calls) are in script tags on an HTML page, Mimosa will not find any modules to compile for optimization and therefore will not run optimization, so you'll need to provide your own configuration in <code class="option">overrides</code> and set <code class="option">inferConfig</code> to <code class="option">false</code>.</p>


    </section>
    <section id="min">
      <div class="page-header">
        <h1>
          Minify
          <small><span class="options">shrink down assets but keep them apart</span></small>
        </h1>
      </div>

      <p>For both the <code class="option">build</code> and <code class="option">watch</code> commands, Mimosa provides an <code class="option">--minify</code> flag that will run <a href="https://github.com/mishoo/UglifyJS">Uglify</a> over your compiled JavaScript assets.  You have the ability in the mimosa-config to exclude certain files from this minification using the <code class="option">minify.exclude</code> setting.  By default any file already possessing <code class="option">.min.</code> in the path name will be excluded as it is assumed to already be minified.</p>

    </section>
    <section id="minopt">
      <div class="page-header">
        <h1>
          Minify + Optimize
          <small><span class="options">customize your minification strategy</span></small>
        </h1>
      </div>

      <p>For either the <code class="option">build</code> or <code class="option">watch</code> commands, using the <code class="option">--minify</code> and <code class="option">--optimize</code> flags together gives you increased control over the optimization workflow.</p>

      <p>The r.js optimizer by itself is often good enough to handle minifying, compressing and pulling your modules into single files; however, the occasional file does not take kindly to being run through Uglify and will be broken when compressed. The r.js optimizer is all or none, you cannot choose to omit a file that isn't being compressed correctly. So if your application doesn't run because of errors in Uglifying, you are forced to inject other steps into your project's life cycle to both use the optimizer and have minified files.</p>

      <p>When both minifying and optimizing, r.js minification is turned off. Specifically the <code class="option">optimize</code> setting of r.js is set to <code class="option">none</code>. The optimizer is still used to pull all of your application's files together into the same file and wrap it in Almond. But Mimosa will Uglify your files itself first, before calling the optimizer, and Mimosa gives you the opportunity to not Uglify whatever files are not making it through Uglifying in working order.</p>

      <p>The <a href="https://github.com/dbashford/AngularFunMimosa">AngularFunMimosa</a> demo project is a perfect example of a project that benefits from this functionality. <a href="https://github.com/dbashford/AngularFunMimosa/commit/1816016a3444ab960dd79c2f65b63c6bf9fdc488#L1L9">This commit</a> from that project shows the effect of the minify+optimize feature being added to Mimosa. Previously optimization was turned off via Mimosa's r.js overrides, because when r.js Uglified the code, it also broke the application. When this Mimosa feature was added, the r.js override was removed, and the file that was not surviving Uglifying, <code class='option'>main.js</code>, was simply omitted from minification.  What comes out the other side is a fully r.js optimized and zipped up file that is fully compressed with the exception of the file that cannot be minified.</p>

    </section>
    <section id="css">
      <div class="page-header">
        <h1>
          CSS
          <small><span class="options">it gets minified too</span></small>
        </h1>
      </div>
      <p>When the <code class="option">--optimize</code> flag is used, Mimosa will minify all of your compiled CSS files. And that about covers that.</p>
    </section>
  </section>



</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.7.2.min.js"><\/script>')</script>
<script src="js/vendor/bootstrap-collapse.js"></script>
<script src="js/vendor/bootstrap-scrollspy.js"></script>

<!-- scripts concatenated and minified via build script -->
<script src="js/plugins.js"></script>
<script src="js/main.js"></script>
<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
<!-- end scripts -->

<script>
    var _gaq=[['_setAccount','UA-33737130-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>